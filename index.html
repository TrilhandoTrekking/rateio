<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calculadora de Rateio - Van</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cálculo do Valor da Van</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="logoVan.ico" type="image/x-icon">
    <meta property="og:title" content="Rateio da Van">
    <meta property="og:description" content="CÁLCULO DO VALOR DA VAN">
    <meta property="og:image" content="https://trilhandotrekking.github.io/rateio/logoVan.png">
    <meta property="og:url" content="https://trilhandotrekking.github.io/rateio/">
<style>
  body{font-family:Inter,Arial,Helvetica,sans-serif;background:#f5f7fb;color:#1b1f23;padding:22px}
  .card{max-width:860px;margin:18px auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.06)}
  h1{margin:0 0 10px;font-size:18px}
  label{display:block;margin-top:12px;font-weight:600;font-size:13px}
  input[type=number]{width:100%;padding:10px;border-radius:8px;border:1px solid #d7dbe6;margin-top:6px;box-sizing:border-box}
  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button{ -webkit-appearance:none;margin:0 }
  input[type=number]{ -moz-appearance:textfield }
  .row{display:flex;gap:12px}
  .col{flex:1}
  .note{font-size:13px;color:#4b5563;margin-top:10px}
  .resultado{margin-top:18px;background:#f0f9ff;padding:14px;border-radius:10px}
  .linha{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed rgba(0,0,0,0.06)}
  .linha:last-child{border-bottom:0}
  .btn{margin-top:14px;padding:10px;border-radius:10px;border:0;background:#0b63c6;color:#fff;font-weight:700;cursor:pointer;width:100%}
  .small{font-size:13px;color:#334155}
</style>
</head>
<body>
  <div class="card">
    <h1>Calculadora de Rateio - Van</h1>

    <label for="valorVan">Valor da Van (R$)</label>
    <input id="valorVan" type="number" step="0.01" min="0" inputmode="decimal" value="3000">

    <div class="row">
      <div class="col">
        <label for="totalVagas">Quantidade de vagas</label>
        <input id="totalVagas" type="number" min="1" step="1" inputmode="numeric" value="15">
      </div>
      <div class="col">
        <label for="guiasExtras">Quantidade de guias extras</label>
        <input id="guiasExtras" type="number" min="0" step="1" inputmode="numeric" value="0">
      </div>
    </div>

    <button class="btn" id="botaoCalcular">Calcular</button>

    <div id="resultado" class="resultado" style="display:none"></div>

    <p class="note">
      Regras aplicadas: <strong>Sempre</strong> 2 guias isentos e <strong>sempre</strong> 1 Caixa.<br>    
    </p>
  </div>

<script>
  const valorVanEl = document.getElementById('valorVan');
  const totalVagasEl = document.getElementById('totalVagas');
  const guiasExtrasEl = document.getElementById('guiasExtras');
  const resultadoEl = document.getElementById('resultado');
  const botao = document.getElementById('botaoCalcular');

  const GUIAS_ISENTOS = 2;
  const CAIXA = 1;

  [valorVanEl, totalVagasEl, guiasExtrasEl].forEach(i => {
    i.addEventListener('input', e => {
      e.target.value = e.target.value.replace(/[^0-9.,-]/g, '');
    });
    i.addEventListener('input', calcular);
  });

  botao.addEventListener('click', calcular);
  window.addEventListener('DOMContentLoaded', calcular);

  function fmtBR(num){
    return Number(num).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  }

  function round2(num){ return Math.round((num + Number.EPSILON) * 100) / 100; }

  function calcular(){
    const valorVan = parseFloat(valorVanEl.value.replace(',', '.')) || 0;
    const totalVagas = parseInt(totalVagasEl.value,10) || 0;
    const guiasExtras = parseInt(guiasExtrasEl.value,10) || 0;

    if (valorVan <= 0){
      resultadoEl.style.display = 'block';
      resultadoEl.innerHTML = `<p class="small">Informe um <strong>Valor da Van</strong> maior que zero.</p>`;
      return;
    }
    if (totalVagas <= GUIAS_ISENTOS){
      resultadoEl.style.display = 'block';
      resultadoEl.innerHTML = `<p class="small">Total de vagas precisa ser maior que ${GUIAS_ISENTOS} (guias isentos).</p>`;
      return;
    }

    const vagasParticipantes = totalVagas - GUIAS_ISENTOS;
    const pagantesQueDividemVan = vagasParticipantes - CAIXA;

    if (pagantesQueDividemVan <= 0){
      resultadoEl.style.display = 'block';
      resultadoEl.innerHTML = `<p class="small">Com esses valores não há pagantes suficientes para dividir a Van. Verifique vagas/guia.</p>`;
      return;
    }

    const valorPorParticipante = valorVan / pagantesQueDividemVan;
    const totalArrecadadoParticipantes = valorPorParticipante * vagasParticipantes;
    const valorDestinadoCaixa = valorPorParticipante;
    const totalPagoGuiasExtras = guiasExtras * valorPorParticipante;
    const totalGuiasQueRecebem = GUIAS_ISENTOS + guiasExtras;
    const rateioPorGuia = totalGuiasQueRecebem > 0 ? totalPagoGuiasExtras / totalGuiasQueRecebem : 0;

    const vp = round2(valorPorParticipante);
    const tAP = round2(totalArrecadadoParticipantes);
    const tPGE = round2(totalPagoGuiasExtras);
    const rPG = round2(rateioPorGuia);
    const reversaEspera = round2(valorVan + valorPorParticipante);
    const reversaCalc = tAP;
    const dif = round2(Math.abs(reversaEspera - reversaCalc));

    // 🟢 Exibição condicional para guias extras
    const blocoGuiasExtras = guiasExtras > 0 ? `
      <div class="linha"><div>Guias extras (pagantes):</div><div>${guiasExtras}</div></div>
      <div class="linha"><div>Total da soma guias extras:</div><div><strong>${fmtBR(tPGE)}</strong></div></div>
      <div class="linha"><div>Soma dos guias extras dividido por:</div><div>${totalGuiasQueRecebem}</div></div>
      <div class="linha"><div><strong>Valor por guia:</strong></div><div><strong>${fmtBR(rPG)}</strong></div></div>
    ` : `
      <div class="linha"><div>Guias extras:</div><div>0</div></div>
    `;

    resultadoEl.style.display = 'block';
    resultadoEl.innerHTML = `
      <h3>Resumo</h3>
      <div class="linha"><div>Total de participantes:</div><div><strong>${totalVagas}</strong></div></div>
      <div class="linha"><div>Guias isentos (fixo):</div><div>${GUIAS_ISENTOS}</div></div>
      <div class="linha"><div>Total de pagantes:</div><div><strong>${vagasParticipantes}</strong></div></div>
      <div class="linha"><div>Caixa:</div><div>${CAIXA}</div></div>
      <div class="linha"><div>Valor da Van dividido por:</div><div><strong>${pagantesQueDividemVan}</strong></div></div>

      <div class="linha"><div><strong>Valor por participante:</strong></div><div><strong>${fmtBR(vp)}</strong></div></div>
      <div class="linha"><div>Destinada ao Caixa:</div><div><strong>${fmtBR(valorDestinadoCaixa)}</strong></div></div>

      ${blocoGuiasExtras}

      <div class="linha"><div>Destinada à Van:</div>
      <div><strong>${fmtBR(round2(valorPorParticipante * pagantesQueDividemVan))}</strong></div></div>

      <div class="linha"><div>Total arrecadado mais Caixa</div>
      <div><strong>${fmtBR(reversaCalc)}</strong></div></div>

      <div style="height:50px"></div>
      <p class="small">
        Cálculo esperado: <strong>${fmtBR(reversaEspera)}</strong>.<br>
        Diferença: <strong>${fmtBR(dif)}</strong> (apenas arredondamento).
      </p>
    `;
  }
</script>
</body>
</html>
